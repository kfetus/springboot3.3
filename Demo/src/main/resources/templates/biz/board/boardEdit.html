<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.com">
<head>
	<meta charset="UTF-8">
	<title>게시판 상세</title>
	 
	<link th:href="@{/css/base.css}" rel="stylesheet" />
	<script th:src="@{/js/comm/jquery-3.7.1.js}"></script>
	<script th:src="@{/js/comm/siteComm.js}"></script>

	<script>

	const boardList = (nowPage) => {
		console.log('ajax start');

		$("#boardList").show();
		$("#boardDetail").hide();

		let pageListCnt = 8;
		console.log($("#listTable tr").length);
		if ( $("#listTable tr").length != 1) {
			while($("#listTable tr").length != 1) {
				$("#listTable > tbody:last > tr:last").remove();
			}
		}

		$.ajax({
			type : "POST",
			url : "/board/boardList.do",
			async : true,
			dataType : 'json',
			data : JSON.stringify({ 'nowPage':nowPage, 'pageListCnt':pageListCnt, 'category':$("#category").val(), 'title':$("#title").val() }),    
			success : function(result) {
				console.log(result);
				let appendStr;
				$(result.RESULT_LIST).each(function(index){
					appendStr += "<TR>";
					appendStr += '<TD>'+result.RESULT_LIST[index].SEQ + '</TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].CATEGORY + '</TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].CODE_NAME + '</TD>';
					appendStr += '<TD><a href="javascript:showDetail('+result.RESULT_LIST[index].SEQ+')">'+result.RESULT_LIST[index].TITLE + '</a></TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].BODY_TEXT + '</TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].USER_NO + '</TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].REG_DT + '</TD>';
					appendStr += '<TD>'+result.RESULT_LIST[index].CNG_DT + '</TD>';
					appendStr += '</TR>';
				});
				
                $("#listTable").append(appendStr);
                fn_makePaging(nowPage,result.RESULT_TOTAL_CNT,pageListCnt,'paging','boardList');
			},
			error : function(res) {
				console.log(res.status);
				console.log(res.responseJSON);
			}
		});		
	}	

	const moveList = () => {
		$("#mainForm").attr("action", "/board/boardList.do");
		gfn_submit('mainForm');		
	}
	
	$(function() {
		//XSS 처리를 위한 방법. 서버에서 처리해서 th:text로 해도 되고. thymeleaf가 아닐경우 escape이 자동 처리 되지 않으면 아래와 같이 처리
		$("#bodyText").text(gfn_changeXSS($("#bodyText").text()));
		
	})
	
	</script>

</head>
<body>
	<div>
		<form action="" method="post" id="mainForm" name="mainForm" onsubmit="return false">
		<div>
			<label for="category">분류</label>
			<select name="category" id="category">
			<option value="" th:selected="category == ''">선택하세요</option>
	        <option th:each="code: ${codeList}" th:value="${code.CODE}" th:text="${code.CODE_NAME}" th:selected="${category == code.CODE}">코드명</option>
			</select>
			<label for="srcTitle">제목</label>
			<input name="srcTitle" id="srcTitle" placeholder="제목입력" th:value="${boardData?.TITLE}"/>
		</div>
		<div style="padding: 10px;"></div>
		<div>
			<label for="bodyText" style="vertical-align: top;">내용</label>
			<textarea name="bodyText" id="bodyText" cols="54" rows="10" placeholder="내용입력" th:text="${boardData?.BODY_TEXT}"></textarea>
		</div>
		<div th:if="${not #strings.isEmpty(paramSeq)}">
			<span>첨부파일 명 :</span><span th:text="${boardData?.FILE_NAME}"></span>
			<span>크기:</span><span th:text="${boardData?.FILE_SIZE}"></span><span>Byte</span>
		</div>
		<div th:if="${#strings.isEmpty(paramSeq)}">
			<label for="srcAddFile">첨부파일</label>
			<input type="file" id="srcAddFile"  />
		</div>
		</form>		
	</div>
	<div style="padding: 10px;"></div>
	<div th:if="${#lists.size(commentList) != 0}">
		<div>
			<div style="padding: 1px;"></div>
			<h3>댓글목록</h3>
		</div>
		<div>
			<div th:each="rowData:${commentList}">
				<h4>[[${rowDataStat.count}]]댓글 제목:[[${rowData.TITLE}]]</h4>
				<p>내용:[[${rowData.BODY_TEXT}]]</p>
			</div>
		</div>
	</div>
	<div style="padding: 10px;"></div>
	<div>
		<button type="button" id="s1" onclick="javascript:submitUpload();"><span>submit저장</span></button>
		<button type="button" id="s1" onclick="javascript:moveList();"><span><strong>목록</strong></span></button>
	</div>
</body>
</html>